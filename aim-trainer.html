<script>
  const game = document.getElementById('game');
  const timeDisplay = document.getElementById('time');
  const bestDisplay = document.createElement('div');
  document.body.appendChild(bestDisplay);

  let times = [];
  let shots = 0;
  const totalTargets = 10;

  function updateBest(avg) {
    const best = localStorage.getItem('aimTrainerBest');
    if (!best || avg < parseFloat(best)) {
      localStorage.setItem('aimTrainerBest', avg.toFixed(2));
    }
    bestDisplay.textContent = `🏆 Best Avg: ${localStorage.getItem('aimTrainerBest')}ms`;
  }

  function spawnTarget() {
    const target = document.createElement('div');
    target.classList.add('target');
    target.style.top = Math.random() * (window.innerHeight - 40) + 'px';
    target.style.left = Math.random() * (window.innerWidth - 40) + 'px';

    const appearTime = performance.now();
    target.addEventListener('click', () => {
      const reaction = performance.now() - appearTime;
      times.push(reaction);
      shots++;
      target.remove();

      if (shots >= totalTargets) {
        const avg = times.reduce((a, b) => a + b) / times.length;
        timeDisplay.textContent = `Average: ${avg.toFixed(2)}ms`;
        updateBest(avg);
        times = [];
        shots = 0;
      } else {
        setTimeout(spawnTarget, 500);
      }
    });

    game.appendChild(target);
  }

  updateBest(Infinity);
  spawnTarget();
</script>
