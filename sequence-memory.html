<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sequence Memory</title>
<style>
  html, body {
    margin: 0; padding: 0; height: 100vh;
    background: #111;
    color: white;
    font-family: sans-serif;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    user-select: none;
    transition: background 0.3s, color 0.3s;
  }
  body.light {
    background: #f4f4f4;
    color: #111;
  }
  #backButton {
    position: fixed; top: 20px; left: 20px;
    padding: 10px 15px;
    background: #444; border: none; border-radius: 5px;
    color: white; cursor: pointer;
  }
  #backButton:hover {
    background: #666;
  }
  #grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 10px;
    margin-top: 60px;
    width: 90vw;
    max-width: 600px;
  }
  .tile {
    background: #333;
    border-radius: 10px;
    cursor: pointer;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: background-color 0.3s, transform 0.3s;
    user-select: none;
  }
  body.light .tile {
    background: #ccc;
  }
  .tile.active {
    background: #4CAF50 !important;
    transform: scale(1.1);
  }
</style>
</head>
<body>
<button id="backButton" onclick="window.location.href='index.html'">‚Üê Back</button>
<div id="message">Watch the sequence, then repeat by clicking tiles in order.</div>
<div id="grid"></div>

<script>
  const grid = document.getElementById('grid');
  const message = document.getElementById('message');
  let sequence = [];
  let userIndex = 0;
  let level = 1;
  let inputEnabled = false;

  // Create tiles
  function createTiles(tileSize) {
    grid.innerHTML = '';
    grid.style.gridTemplateColumns = `repeat(4, ${tileSize}px)`;
    grid.style.gridTemplateRows = `repeat(4, ${tileSize}px)`;
    for(let i=0; i<16; i++) {
      const tile = document.createElement('div');
      tile.classList.add('tile');
      tile.style.width = tileSize + 'px';
      tile.style.height = tileSize + 'px';
      tile.dataset.index = i;
      grid.appendChild(tile);
    }
  }

  function getRandomTile() {
    return Math.floor(Math.random() * 16);
  }

  function playSequence() {
    inputEnabled = false;
    let i = 0;
    message.textContent = "Watch the sequence...";
    const interval = setInterval(() => {
      if(i > 0) {
        const prevTile = grid.querySelector(`.tile[data-index='${sequence[i-1]}']`);
        prevTile.classList.remove('active');
      }
      if(i === sequence.length) {
        clearInterval(interval);
        inputEnabled = true;
        userIndex = 0;
        message.textContent = "Your turn! Click the tiles in order.";
        return;
      }
      const tile = grid.querySelector(`.tile[data-index='${sequence[i]}']`);
      tile.classList.add('active');
      i++;
    }, 800);
  }

  function nextLevel() {
    // Increase tile size as level grows (min 40px, max 100px)
    let tileSize = Math.min(40 + level * 3, 100);
    createTiles(tileSize);

    sequence.push(getRandomTile());
    playSequence();
  }

  grid.addEventListener('click', e => {
    if(!inputEnabled) return;
    if(!e.target.classList.contains('tile')) return;

    const clickedIndex = parseInt(e.target.dataset.index);
    if(clickedIndex === sequence[userIndex]) {
      e.target.classList.add('active');
      setTimeout(() => e.target.classList.remove('active'), 300);
      userIndex++;
      if(userIndex === sequence.length) {
        inputEnabled = false;
        message.textContent = "Correct! Next level...";
        level++;
        setTimeout(nextLevel, 1500);
      }
    } else {
      gameOver();
    }
  });

  function gameOver() {
    message.textContent = `Game Over! You reached level ${level}.`;
    saveScore(level);
    sequence = [];
    level = 1;
    inputEnabled = false;
    setTimeout(() => {
      message.textContent = "Starting new game...";
      nextLevel();
    }, 3000);
  }

  function saveScore(score) {
    let best = localStorage.getItem("sequenceMemory");
    if(!best || score > best) {
      localStorage.setItem("sequenceMemory", score);
    }
    const name = prompt("Enter your name for leaderboard:");
    if(name) {
      // Firebase submission placeholder
      console.log(`Name: ${name}, Sequence Memory Level: ${score}`);
    }
  }

  window.onload = () => {
    if(localStorage.getItem("theme") === "light") {
      document.body.classList.add("light");
    }
    nextLevel();
  };
</script>
</body>
</html>
